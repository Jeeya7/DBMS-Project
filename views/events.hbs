<h1>Events</h1>

<p>This page will allow viewing and managing campus events.</p>

<table class="table">
  <thead>
    <tr>
      <th>Event ID</th>
      <th>Name</th>
      <th>Date</th>
      <th>Start Time</th>
      <th>Expected Attendance</th>
      <th>Location</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    {{#if events.length}}
      {{#each events}}
        <tr>
          <td>{{this.eventId}}</td>
          <td>{{this.eventName}}</td>
          <td>{{this.eventDate}}</td>
          <td>{{this.startTime}}</td>
          <td>{{this.expectedAttendance}}</td>
          <td>{{this.Locations_locationId}}</td>
          <td>
            <form action="/delete-event" method="POST" style="display:inline;">
              <input type="hidden" name="eventId" value="{{this.eventId}}">
              <button type="submit">Delete</button>
            </form>
          </td>
        </tr>
      {{/each}}
    {{else}}
      <tr><td colspan="7">No event data yet.</td></tr>
    {{/if}}
  </tbody>
</table>


<h3>Update Event Details</h3>

<form action="/update-event" method="POST" class="update-form">
  <!-- 1️⃣ Select Event by ID -->
  <label for="eventId">Select Event ID:</label>
  <select id="eventId" name="eventId" required>
    <option value="">-- Select an Event ID --</option>
    {{#each events}}
      <option 
        value="{{this.eventId}}" 
        data-name="{{this.eventName}}" 
        data-date="{{this.eventDate}}" 
        data-start="{{this.startTime}}" 
        data-attendance="{{this.expectedAttendance}}" 
        data-location="{{this.Locations_locationId}}">
        {{this.eventId}} — {{this.eventName}}
      </option>
    {{/each}}
  </select>

  <!-- 2️⃣ Autofilled fields -->
  <label for="eventName">Event Name:</label>
  <input type="text" id="eventName" name="eventName" placeholder="Enter new name">

  <label for="eventDate">Event Date:</label>
  <input type="date" id="eventDate" name="eventDate">

  <label for="startTime">Start Time:</label>
  <input type="time" id="startTime" name="startTime">

  <label for="expectedAttendance">Expected Attendance:</label>
  <input type="number" id="expectedAttendance" name="expectedAttendance" placeholder="e.g. 150">

  <label for="locationId">Location ID:</label>
  <input type="number" id="locationId" name="locationId" placeholder="e.g. 2">

  <button type="submit">Update Event</button>
</form>

<script>
  // when user selects an event ID
  document.getElementById('eventId').addEventListener('change', function () {
    const selected = this.options[this.selectedIndex];

    // read data attributes
    const name = selected.getAttribute('data-name');
    const date = selected.getAttribute('data-date');
    const start = selected.getAttribute('data-start');
    const attendance = selected.getAttribute('data-attendance');
    const location = selected.getAttribute('data-location');

    // fill corresponding fields
    document.getElementById('eventName').value = name || '';
    document.getElementById('eventDate').value = date ? date.split('T')[0] : ''; // strip time if needed
    document.getElementById('startTime').value = start || '';
    document.getElementById('expectedAttendance').value = attendance || '';
    document.getElementById('locationId').value = location || '';
  });
</script>
